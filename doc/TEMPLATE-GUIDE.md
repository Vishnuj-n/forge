# Forge Template Guide

This guide explains how to create, structure, and share Forge templates.

## ğŸ“ Template Structure

A Forge template is a directory containing a configuration file and resources.

```
my-template/
â”œâ”€â”€ template.yaml      # Configuration (Required)
â”œâ”€â”€ README.md          # Documentation (Recommended)
â”œâ”€â”€ files/             # Files to copy (Optional)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â””â”€â”€ main.py
â”‚   â””â”€â”€ config.json
â””â”€â”€ patches/           # Files to append (Optional)
    â”œâ”€â”€ .gitignore.append
    â””â”€â”€ .env.append
```

---

## âš™ï¸ The `template.yaml` File

This is the heart of your template. It defines what commands to run and what files to create.

### Basic Structure

```yaml
name: my-template-name

commands:
  # List of commands to run (optional)
  - cmd: ["git", "init"]

files:
  # File operations (optional)
  copy:
    - files/
  append:
    - target: ".gitignore"
      source: "patches/.gitignore.append"
```

---

## ğŸš€ Commands

Commands are executed **in order** inside a temporary workspace.

### Syntax

Commands are lists of strings (token arrays). Do not use shell strings.

**âœ… Correct:**
```yaml
commands:
  - cmd: ["npm", "install", "react"]
  - cmd: ["git", "commit", "-m", "Initial commit"]
```

**âŒ Incorrect:**
```yaml
commands:
  - cmd: "npm install react"  # Error: Shell strings not supported
  - cmd: ["npm install react"] # Error: One single argument
```

### Best Practices for Commands
-   **No Interactivity:** Assume commands run silently. If a command prompts for input, it will fail (unless the user runs `forge init --interactive`).
-   **Fail Fast:** If a command returns a non-zero exit code, Forge stops immediately.
-   **Environment:** Commands run in a clean, temporary directory.

---

## ğŸ“‚ File Operations

File operations happen **after** all commands have executed.

### 1. Copy

Copies files or directories from your template's `files/` folder to the project root.

```yaml
files:
  copy:
    - files/README.md         # Copies single file
    - files/src               # Copies directory recursively
```

**Note:** If a file already exists (e.g., created by a command), it will be overwritten by the copy operation.

### 2. Append

Appends content from your template's `patches/` folder to existing files in the project.

```yaml
files:
  append:
    - target: ".gitignore"          # File in the project to modify
      source: "patches/gitignore"   # File in your template containing text to append
```

**Use Case:** Adding specific ignores to a `.gitignore` generated by `git init`, or adding variables to a `.env` file.

**Safety:** Forge never modifies files in place or merges structured data (like JSON). It only appends to the end of the file.

---

## ğŸ’¡ Best Practices

1.  **Keep it Simple:** Templates should be declarative. Avoid complex logic.
2.  **Document Your Template:** Include a `README.md` inside your template directory explaining what it does and what tools are required (e.g., "Requires Node.js and Git").
3.  **Test Often:** Use `forge test <template-path>` to verify your template works without creating junk directories.
4.  **Use `forge new`:** Use the built-in scaffolding command to start a new template:
    ```powershell
    forge new my-template
    ```

---

## ğŸ” Troubleshooting

### Command Fails
If a command fails, `forge test` will show the output.
-   **Common Cause:** Tool not installed on the user's machine (e.g., `uv` or `npm` missing).
-   **Fix:** Document prerequisites in your template's README.

### Patch Fails
-   **Error:** "Target file not found"
-   **Cause:** You are trying to append to a file that wasn't created by a command or a copy operation.
-   **Fix:** Ensure the target file exists before trying to patch it.

---

## ğŸ“ Example: Python Project with Git

**Filesystem:**
```
python-git/
â”œâ”€â”€ template.yaml
â”œâ”€â”€ files/
â”‚   â””â”€â”€ main.py
â””â”€â”€ patches/
    â””â”€â”€ gitignore.append
```

**template.yaml:**
```yaml
name: python-git

commands:
  - cmd: ["git", "init"]
  # Create a virtual environment (example using standard library)
  - cmd: ["python", "-m", "venv", ".venv"]

files:
  copy:
    - files/main.py

  append:
    - target: ".gitignore"
      source: "patches/gitignore.append"
```

**patches/gitignore.append:**
```text

# Python
__pycache__/
*.py[cod]
.venv/
```
